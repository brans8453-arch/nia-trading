<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>NIA TRADING</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1c;color:white}
header{background:#111a33;padding:12px;text-align:center;position:sticky;top:0}
.menu{position:absolute;right:10px;top:12px;font-size:24px;cursor:pointer}
.section{padding:12px;border-bottom:1px solid #222}
button{padding:10px;border:none;border-radius:6px;background:#1f6bff;color:white;margin:5px}
input,select{padding:10px;width:95%;margin:5px}
.green{color:#00e676}
.red{color:#ff5252}
.card{background:#141d3a;padding:8px;margin:5px 0;border-radius:6px}
#chart{width:100%;height:260px;background:#050816}
#menuBox{
display:none;
position:absolute;
right:10px;
top:40px;
background:#111;
padding:10px;
border-radius:6px
}
</style>
</head>

<body>

<header>
<h2>NIA TRADING</h2>
<div id="userInfo">Marché public</div>
<div class="menu" onclick="toggleMenu()">⋮</div>

<div id="menuBox">
<button onclick="openLogin()">Connexion / Compte</button>
</div>
</header>

<!-- GRAND GRAPHIQUE -->
<div class="section">
<canvas id="chart"></canvas>
</div>

<!-- PRIX -->
<div class="section">
<h3>Marché Live</h3>
BTC/USDT : <span id="BTC"></span><br>
ETH/USDT : <span id="ETH"></span>
</div>

<!-- ZONE UTILISATEUR -->
<div id="app" style="display:none">

<div class="section">
<h3>Trading</h3>
<select id="pair">
<option value="BTC">BTC</option>
<option value="ETH">ETH</option>
</select>
<input id="qty" placeholder="Quantité">
<button onclick="trade('buy')">ACHETER</button>
<button onclick="trade('sell')">VENDRE</button>
</div>

<div class="section">
<h3>Wallet</h3>
Solde : <span id="balance"></span><br>
<button onclick="modal('deposit')">Dépôt</button>
<button onclick="modal('withdraw')">Retrait</button>
<button onclick="modal('send')">Envoyer</button>
</div>

<div class="section">
<h3>Historique</h3>
<div id="history"></div>
</div>

</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000a">
<div id="modalContent" style="background:#111;margin:20% auto;padding:15px;width:90%"></div>
<button onclick="closeModal()">Fermer</button>
</div>

<script>
let users=JSON.parse(localStorage.getItem("niaUsers")||"{}");
let currentUser=null;
let prices={BTC:42000,ETH:2300};

function saveUsers(){
localStorage.setItem("niaUsers",JSON.stringify(users));
}

function toggleMenu(){
menuBox.style.display =
menuBox.style.display=="block"?"none":"block";
}

function openLogin(){
modalContent.innerHTML=`
<h3>Connexion / Compte</h3>
<input id="email" placeholder="Email">
<input id="code" placeholder="Code 6 chiffres">
<button onclick="login()">Entrer</button>`;
modal.style.display="block";
}

function login(){
let email=document.getElementById("email").value;
let code=document.getElementById("code").value;

if(!users[email]){
users[email]={
uid:"NIA"+Math.floor(Math.random()*100000),
code,
balance:0,
wallet:{BTC:0,ETH:0},
history:[]
};
}

if(users[email].code!==code){
alert("Code incorrect");
return;
}

currentUser=users[email];
app.style.display="block";
userInfo.textContent="UID: "+currentUser.uid;
updateUI();
closeModal();
}

function updateUI(){
balance.textContent=currentUser.balance+" USDT";
renderHistory();
}

function addHistory(t){
currentUser.history.push(t);
saveUsers();
renderHistory();
}

function renderHistory(){
history.innerHTML="";
currentUser.history.slice(-8).reverse().forEach(h=>{
history.innerHTML+="<div class='card'>"+h+"</div>";
});
}

function trade(side){
let pair=document.getElementById("pair").value;
let qty=parseFloat(document.getElementById("qty").value);
if(!qty) return;

let total=qty*prices[pair];

if(side=="buy"){
if(currentUser.balance<total) return alert("Solde insuffisant");
currentUser.balance-=total;
currentUser.wallet[pair]+=qty;
addHistory("Achat "+qty+" "+pair);
}else{
if(currentUser.wallet[pair]<qty) return alert("Crypto insuffisante");
currentUser.wallet[pair]-=qty;
currentUser.balance+=total;
addHistory("Vente "+qty+" "+pair);
}

saveUsers();
updateUI();
}

function modal(type){
if(type=="deposit"){
modalContent.innerHTML=`Montant<input id="amt">
<button onclick="deposit()">Confirmer</button>`;
}
if(type=="withdraw"){
modalContent.innerHTML=`Montant<input id="amt">
<button onclick="withdraw()">Confirmer</button>`;
}
if(type=="send"){
modalContent.innerHTML=`Email<input id="dest">
Montant<input id="amt">
<button onclick="send()">Confirmer</button>`;
}
modal.style.display="block";
}

function deposit(){
let amt=parseFloat(amt.value);
currentUser.balance+=amt;
addHistory("Dépôt "+amt);
saveUsers();
updateUI();
closeModal();
}

function withdraw(){
let amt=parseFloat(amt.value);
currentUser.balance-=amt;
addHistory("Retrait "+amt);
saveUsers();
updateUI();
closeModal();
}

function send(){
let dest=dest.value;
let amt=parseFloat(amt.value);

if(!users[dest]) return alert("Introuvable");

currentUser.balance-=amt;
users[dest].balance+=amt;

addHistory("Envoi "+amt+" à "+dest);
saveUsers();
updateUI();
closeModal();
}

function closeModal(){
modal.style.display="none";
}

/* PRIX MARCHÉ */
function market(){
for(let p in prices){
prices[p]+=Math.random()*200-100;
let el=document.getElementById(p);
if(el){
el.textContent=Math.round(prices[p]);
el.className=(Math.random()>0.5?"green":"red");
}
}
}
setInterval(market,3000);

/* GRAPH SIMPLE */
let ctx=document.getElementById("chart").getContext("2d");
let data=Array(50).fill(200);

function drawChart(){
ctx.clearRect(0,0,chart.width,chart.height);
ctx.beginPath();
ctx.strokeStyle="#1f6bff";

data.forEach((v,i)=>{
let x=i*chart.width/data.length;
let y=chart.height-v;
if(i===0) ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});
ctx.stroke();

data.push(data[data.length-1]+Math.random()*20-10);
data.shift();
}

setInterval(drawChart,1000);
</script>

</body>
</html>
